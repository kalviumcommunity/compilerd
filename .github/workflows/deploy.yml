  name: Deploy to Render
  on:
    push:
      branches:
        - main
  jobs:
    build:
      runs-on: ubuntu-latest
      steps:
        - name: Checkout code
          uses: actions/checkout@v2
        - name: Login to Docker Hub
          run: docker login -u ${{ secrets.DOCKER_USERNAME }} -p ${{ secrets.DOCKER_PASSWORD }}
        - name: Build the Docker image
          run: docker build -t harshpsharma/compilerd . && docker images
        - name: Push the Docker image to Docker Hub
          run: docker push harshpsharma/compilerd:latest
        - name: Deploy to Render
          run: | curl -X POST \
               -H "Authorization: Bearer ${{ secrets.RENDER_TOKEN }}" \
               -H "Content-Type: application/json" \
               -d '{"image": "harshpsharma/compilerd:latest"}' \
               https://api.render.com/v1/services